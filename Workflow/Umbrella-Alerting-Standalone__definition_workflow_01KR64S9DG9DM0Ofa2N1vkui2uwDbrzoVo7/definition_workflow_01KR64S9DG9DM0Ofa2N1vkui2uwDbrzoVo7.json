{
  "workflow": {
    "unique_name": "definition_workflow_01KR64S9DG9DM0Ofa2N1vkui2uwDbrzoVo7",
    "name": "Umbrella - Alerting - Standalone",
    "title": "Umbrella - Alerting - Standalone",
    "type": "generic.workflow",
    "base_type": "workflow",
    "variables": [
      {
        "schema_id": "datatype.integer",
        "properties": {
          "value": 1,
          "scope": "local",
          "name": "Always True Condition",
          "type": "datatype.integer",
          "is_required": false,
          "is_invisible": false
        },
        "unique_name": "variable_workflow_01KZSVFALJH6I7WEioHFQFBM7Q1wkAUWDZc",
        "object_type": "variable_workflow"
      },
      {
        "schema_id": "tabletype_01EGEGSGVS20N13S1KPEz8fOy2ANAhTiYpj",
        "properties": {
          "scope": "local",
          "name": "Temp_Domain_Table",
          "type": "datatype.table",
          "description": "Temp domain table to store unique domain values",
          "is_required": false,
          "is_invisible": false
        },
        "unique_name": "variable_workflow_01LHU7ZSWQ9315H6GHHZxC1CvAb0E2T1lYN",
        "object_type": "variable_workflow"
      },
      {
        "schema_id": "datatype.integer",
        "properties": {
          "value": 3,
          "scope": "local",
          "name": "Delay",
          "type": "datatype.integer",
          "description": "Number of minutes for the last security activity (use to calculate timestamp from past date)",
          "is_required": false,
          "is_invisible": false
        },
        "unique_name": "variable_workflow_01LHRE7AUO82Z0yYnr8mo6YBlBJZ0Gaab9j",
        "object_type": "variable_workflow"
      }
    ],
    "properties": {
      "atomic": {
        "is_atomic": false
      },
      "delete_workflow_instance": true,
      "description": "Enable near real time notification in Cisco Teams on Umbrella Security events",
      "display_name": "Umbrella - Alerting - Standalone",
      "runtime_user": {
        "override_target_runtime_user": false,
        "specify_on_workflow_start": false,
        "target_default": true
      },
      "target": {
        "execute_on_target_group": false,
        "execute_on_workflow_target": false,
        "no_target": true,
        "specify_on_workflow_start": false
      }
    },
    "object_type": "definition_workflow",
    "actions": [
      {
        "unique_name": "definition_activity_01LGYEK6I903U6eJdNwd8ijytxrnL0PTkmn",
        "name": "Condition Block",
        "title": "Condition Block",
        "type": "logic.if_else",
        "base_type": "activity",
        "properties": {
          "continue_on_failure": false,
          "description": "Check the loop counter (global variable). If not 500 it means a workflow is still running so do nothing)",
          "display_name": "Condition Block",
          "skip_execution": false
        },
        "object_type": "definition_activity",
        "blocks": [
          {
            "unique_name": "definition_activity_01LGYELRBQAFL6iA73FLoqVaCv9qZYZEB4F",
            "name": "Condition Branch",
            "title": "Condition Loop Counter = 500",
            "type": "logic.condition_block",
            "base_type": "activity",
            "properties": {
              "condition": {
                "left_operand": "$global.variable_01LGYFHE8DD8A7767SRhj0daGxv5R67jPTk.global.variable_01LGYFHE8DD8A7767SRhj0daGxv5R67jPTk$",
                "operator": "eq",
                "right_operand": 500
              },
              "continue_on_failure": false,
              "display_name": "Condition Loop Counter = 500",
              "skip_execution": false
            },
            "object_type": "definition_activity",
            "actions": [
              {
                "unique_name": "definition_activity_01LGYGEVMI57B3SdUqi07G41090BQgcGdWb",
                "name": "Set Variables",
                "title": "Reset loop counter",
                "type": "core.set_multiple_variables",
                "base_type": "activity",
                "properties": {
                  "continue_on_failure": false,
                  "display_name": "Reset loop counter",
                  "skip_execution": false,
                  "variables_to_update": [
                    {
                      "variable_to_update": "$global.variable_01LGYFHE8DD8A7767SRhj0daGxv5R67jPTk.global.variable_01LGYFHE8DD8A7767SRhj0daGxv5R67jPTk$",
                      "variable_value_new": 0
                    }
                  ]
                },
                "object_type": "definition_activity"
              },
              {
                "unique_name": "definition_activity_01KR6VTPLBVQZ1CcI9ZOL11Oq3l61dNfoh1",
                "name": "Webex Teams - Search for Room",
                "title": "Webex Teams - Search for Room",
                "type": "workflow.atomic_workflow",
                "base_type": "subworkflow",
                "properties": {
                  "continue_on_failure": false,
                  "display_name": "Webex Teams - Search for Room",
                  "input": {
                    "variable_workflow_01FHMU6RWYQWI3QFUEzjWMT7JYBcz5vquuD": "",
                    "variable_workflow_01FHMU6RWYWY822p43LeMi8Lcx89Q9jeyek": "Alerting",
                    "variable_workflow_01FHMU6RWYY481TVWDm0BQ1p0rWnqak191l": "$global.variable_01KEH4RU5N6VM1dCv2HDrsRXCbj0pv64GI8.global.variable_01KEH4RU5N6VM1dCv2HDrsRXCbj0pv64GI8$",
                    "variable_workflow_01FHNGCYY2O6Z0NcPmUDabszT2P4P0oqMNd": ""
                  },
                  "runtime_user": {
                    "target_default": true
                  },
                  "skip_execution": false,
                  "target": {
                    "override_workflow_target": true,
                    "target_id": "definition_target_01KJANNE7TR2C6ahGVhbhP3X5JvEtPoSLKV",
                    "target_type": "web-service.endpoint"
                  },
                  "workflow_id": "definition_workflow_01FHMU6SD5XPL6eRW4zFXqkA1w8jWiQCIBU"
                },
                "object_type": "definition_activity"
              },
              {
                "unique_name": "definition_activity_01LGYCM2TBHHW34SsNXWWqiq5MoNILcF6OU",
                "name": "While Loop",
                "title": "While Loop (Limit 500)",
                "type": "logic.while",
                "base_type": "activity",
                "properties": {
                  "continue_on_failure": false,
                  "description": "Limit to 500 iteration set by SXAO global env variable",
                  "display_name": "While Loop (Limit 500)",
                  "skip_execution": false
                },
                "object_type": "definition_activity",
                "blocks": [
                  {
                    "unique_name": "definition_activity_01LGYCODGULQN0Mm5xc7sdGmJhVZOE4R09J",
                    "name": "Condition Branch",
                    "title": "Condition Always true",
                    "type": "logic.condition_block",
                    "base_type": "activity",
                    "properties": {
                      "condition": {
                        "left_operand": "$workflow.definition_workflow_01KR64S9DG9DM0Ofa2N1vkui2uwDbrzoVo7.local.variable_workflow_01KZSVFALJH6I7WEioHFQFBM7Q1wkAUWDZc$",
                        "operator": "eq",
                        "right_operand": 1
                      },
                      "continue_on_failure": false,
                      "display_name": "Condition Always true",
                      "skip_execution": false
                    },
                    "object_type": "definition_activity",
                    "actions": [
                      {
                        "unique_name": "definition_activity_01KW9WP8GNVO20cdy0Rx06i2DVNSN6cHVsH",
                        "name": "Group",
                        "title": "Calculate Timestamps",
                        "type": "logic.group",
                        "base_type": "activity",
                        "properties": {
                          "continue_on_failure": false,
                          "display_name": "Calculate Timestamps",
                          "skip_execution": false
                        },
                        "object_type": "definition_activity",
                        "actions": [
                          {
                            "unique_name": "definition_activity_01LHRD8U80BPH5GUdIZdywGKNQiRN654kdR",
                            "name": "Execute Python Script",
                            "title": "Timestamp_from_PastDate",
                            "type": "python3.script",
                            "base_type": "activity",
                            "properties": {
                              "action_timeout": 180,
                              "continue_on_failure": false,
                              "description": "Now - Delay in minutes (local variable)",
                              "display_name": "Timestamp_from_PastDate",
                              "script": "from datetime import datetime, timedelta\nimport sys\n\nif sys.version_info[0] \u003c 3 or sys.version_info[1] \u003c 4:\n    # python version \u003c 3.3\n    import time\n    def timestamp(date):\n        return time.mktime(date.timetuple())\nelse:\n    def timestamp(date):\n        return date.timestamp()\n\ndelay = int(sys.argv[1])\n\ndate1 = datetime.now() - timedelta(minutes=delay)\nts = timestamp(date1)\nprint(ts)",
                              "script_arguments": [
                                "$workflow.definition_workflow_01KR64S9DG9DM0Ofa2N1vkui2uwDbrzoVo7.local.variable_workflow_01LHRE7AUO82Z0yYnr8mo6YBlBJZ0Gaab9j$"
                              ],
                              "skip_execution": false
                            },
                            "object_type": "definition_activity"
                          },
                          {
                            "unique_name": "definition_activity_01LHREWNXUYAQ7NA3YZ6PptJ57qNNhYMtTZ",
                            "name": "Execute Python Script",
                            "title": "Timestamp_Now",
                            "type": "python3.script",
                            "base_type": "activity",
                            "properties": {
                              "action_timeout": 180,
                              "continue_on_failure": false,
                              "display_name": "Timestamp_Now",
                              "script": "from datetime import datetime\nimport sys\n\nif sys.version_info[0] \u003c 3 or sys.version_info[1] \u003c 4:\n    # python version \u003c 3.3\n    import time\n    def timestamp(date):\n        return time.mktime(date.timetuple())\nelse:\n    def timestamp(date):\n        return date.timestamp()\n\ndate1 = datetime.now()\nts = timestamp(date1)\nprint(ts)",
                              "skip_execution": false
                            },
                            "object_type": "definition_activity"
                          }
                        ]
                      },
                      {
                        "unique_name": "definition_activity_01KW9X1ZFZI8O3TEm1j21yrKOtvDj2lv84k",
                        "name": "Group",
                        "title": "Get Unique last blocked destinations (Security)",
                        "type": "logic.group",
                        "base_type": "activity",
                        "properties": {
                          "continue_on_failure": false,
                          "display_name": "Get Unique last blocked destinations (Security)",
                          "skip_execution": false
                        },
                        "object_type": "definition_activity",
                        "actions": [
                          {
                            "unique_name": "definition_activity_01KR65PHOGA942VamdxZjsySHwIcrDl9QOG",
                            "name": "HTTP Request",
                            "title": "Umbrella Get Security Events",
                            "type": "web-service.http_request",
                            "base_type": "activity",
                            "properties": {
                              "action_timeout": 180,
                              "allow_auto_redirect": true,
                              "continue_on_error_status_code": false,
                              "continue_on_failure": true,
                              "display_name": "Umbrella Get Security Events",
                              "method": "GET",
                              "relative_url": "/v1/organizations/1862631/security-activity?limit=500\u0026start=$activity.definition_activity_01LHRD8U80BPH5GUdIZdywGKNQiRN654kdR.output.response_body$\u0026end=$activity.definition_activity_01LHREWNXUYAQ7NA3YZ6PptJ57qNNhYMtTZ.output.response_body$",
                              "runtime_user": {
                                "override_target_runtime_user": false,
                                "target_default": true
                              },
                              "skip_execution": false,
                              "target": {
                                "override_workflow_target": true,
                                "target_id": "definition_target_01JLRTQCEHBA93OQhYXQCrV9TYW4Lmy1oS3"
                              }
                            },
                            "object_type": "definition_activity"
                          },
                          {
                            "unique_name": "definition_activity_01KR6HEHTV4YG1O0OtMpI5BjAFhJOXzV6y3",
                            "name": "Read Table from JSON",
                            "title": "Read Table from JSON",
                            "type": "corejava.read_table_from_json",
                            "base_type": "activity",
                            "properties": {
                              "action_timeout": 180,
                              "continue_on_failure": true,
                              "display_name": "Read Table from JSON",
                              "input_json": "$activity.definition_activity_01KR65PHOGA942VamdxZjsySHwIcrDl9QOG.output.response_body$",
                              "jsonpath_query": "$.requests.[*]",
                              "persist_output": true,
                              "populate_columns": false,
                              "skip_execution": false,
                              "table_columns": [
                                {
                                  "column_name": "destination",
                                  "column_type": "string"
                                }
                              ]
                            },
                            "object_type": "definition_activity"
                          },
                          {
                            "unique_name": "definition_activity_01LHU3TLGVHZX6EFvNcwhJJCoMLIt7hpS69",
                            "name": "Condition Block",
                            "title": "Remove duplicate",
                            "type": "logic.if_else",
                            "base_type": "activity",
                            "properties": {
                              "continue_on_failure": true,
                              "display_name": "Remove duplicate",
                              "skip_execution": false
                            },
                            "object_type": "definition_activity",
                            "blocks": [
                              {
                                "unique_name": "definition_activity_01LHU3VDLSWBF23movP84v1AtRrMgu7dKHM",
                                "name": "Condition Branch",
                                "title": "Condition  only 1 event",
                                "type": "logic.condition_block",
                                "base_type": "activity",
                                "properties": {
                                  "condition": {
                                    "left_operand": "$activity.definition_activity_01KR6HEHTV4YG1O0OtMpI5BjAFhJOXzV6y3.output.row_count$",
                                    "operator": "lte",
                                    "right_operand": 1
                                  },
                                  "continue_on_failure": false,
                                  "display_name": "Condition  only 1 event",
                                  "skip_execution": false
                                },
                                "object_type": "definition_activity",
                                "actions": [
                                  {
                                    "unique_name": "definition_activity_01LKZJ0CDI6U93EEWuTT6EPSNRPShnCQr33",
                                    "name": "Replace String",
                                    "title": "Remove http:// https://",
                                    "type": "core.replacestring",
                                    "base_type": "activity",
                                    "properties": {
                                      "continue_on_failure": true,
                                      "display_name": "Remove http:// https://",
                                      "input_string": "$activity.definition_activity_01KR6HEHTV4YG1O0OtMpI5BjAFhJOXzV6y3.output.read_table_from_json[0].destination$",
                                      "replace_list": [
                                        {
                                          "replaced_string": "http://",
                                          "replacement_string": ""
                                        },
                                        {
                                          "replaced_string": "https://",
                                          "replacement_string": ""
                                        }
                                      ],
                                      "skip_execution": false
                                    },
                                    "object_type": "definition_activity"
                                  },
                                  {
                                    "unique_name": "definition_activity_01LKZL84DBPHP7G5AMKLQk45Ncmk9JVPGYn",
                                    "name": "Match Regex",
                                    "title": "Get domain only",
                                    "type": "core.matchregex",
                                    "base_type": "activity",
                                    "properties": {
                                      "continue_on_failure": false,
                                      "display_name": "Get domain only",
                                      "input_regex": "([a-zA-Z0-9\\.\\-]+)",
                                      "input_string": "$activity.definition_activity_01LKZJ0CDI6U93EEWuTT6EPSNRPShnCQr33.output.result_string$",
                                      "match_case": true,
                                      "skip_execution": false
                                    },
                                    "object_type": "definition_activity"
                                  },
                                  {
                                    "unique_name": "definition_activity_01LHU8ZMQ2Q1Z47u1PI1XYQ0RXF399RVaVt",
                                    "name": "Add Row to Table",
                                    "title": "Add Row to Temp Domain Table",
                                    "type": "core.addrowtotable",
                                    "base_type": "activity",
                                    "properties": {
                                      "action_timeout": 180,
                                      "continue_on_failure": false,
                                      "display_name": "Add Row to Temp Domain Table",
                                      "input_table": "$workflow.definition_workflow_01KR64S9DG9DM0Ofa2N1vkui2uwDbrzoVo7.local.variable_workflow_01LHU7ZSWQ9315H6GHHZxC1CvAb0E2T1lYN$",
                                      "row": [
                                        {
                                          "key": "distinctvalue",
                                          "type": "string",
                                          "value": "$activity.definition_activity_01LKZL84DBPHP7G5AMKLQk45Ncmk9JVPGYn.output.matching_strings[0]$"
                                        }
                                      ],
                                      "skip_execution": false
                                    },
                                    "object_type": "definition_activity"
                                  }
                                ]
                              },
                              {
                                "unique_name": "definition_activity_01LHU3VEJAH0Z3v0STEov3gzTpGvfwq8JDY",
                                "name": "Condition Branch",
                                "title": "Condition more than 1 event",
                                "type": "logic.condition_block",
                                "base_type": "activity",
                                "properties": {
                                  "condition": {
                                    "left_operand": "$activity.definition_activity_01KR6HEHTV4YG1O0OtMpI5BjAFhJOXzV6y3.output.row_count$",
                                    "operator": "gt",
                                    "right_operand": 1
                                  },
                                  "continue_on_failure": false,
                                  "display_name": "Condition more than 1 event",
                                  "skip_execution": false
                                },
                                "object_type": "definition_activity",
                                "actions": [
                                  {
                                    "unique_name": "definition_activity_01LHUKYOBGS5S5qEBp5ACJqtM0CxYfYHVYH",
                                    "name": "JSONPath Query",
                                    "title": "Get all destination values",
                                    "type": "corejava.jsonpathquery",
                                    "base_type": "activity",
                                    "properties": {
                                      "action_timeout": 180,
                                      "continue_on_failure": false,
                                      "display_name": "Get all destination values",
                                      "input_json": "$activity.definition_activity_01KR6HEHTV4YG1O0OtMpI5BjAFhJOXzV6y3.output.response_body$",
                                      "jsonpath_queries": [
                                        {
                                          "jsonpath_query": "$.[*].destination",
                                          "jsonpath_query_name": "destination",
                                          "jsonpath_query_type": "string"
                                        }
                                      ],
                                      "skip_execution": false
                                    },
                                    "object_type": "definition_activity"
                                  },
                                  {
                                    "unique_name": "definition_activity_01KZ2HAND5NFQ1GzRxwwZSdh37DUHNAi9gs",
                                    "name": "Replace String",
                                    "title": "Remove http:// https://",
                                    "type": "core.replacestring",
                                    "base_type": "activity",
                                    "properties": {
                                      "continue_on_failure": true,
                                      "display_name": "Remove http:// https://",
                                      "input_string": "$activity.definition_activity_01LHUKYOBGS5S5qEBp5ACJqtM0CxYfYHVYH.output.jsonpath_queries.destination$",
                                      "replace_list": [
                                        {
                                          "replaced_string": "http://",
                                          "replacement_string": ""
                                        },
                                        {
                                          "replaced_string": "https://",
                                          "replacement_string": ""
                                        }
                                      ],
                                      "skip_execution": false
                                    },
                                    "object_type": "definition_activity"
                                  },
                                  {
                                    "unique_name": "definition_activity_01LHUB7I238QW1lHLBnGyMatda7AqDsDf4c",
                                    "name": "Execute Python Script",
                                    "title": "Get list of unique values",
                                    "type": "python3.script",
                                    "base_type": "activity",
                                    "properties": {
                                      "action_timeout": 180,
                                      "continue_on_failure": false,
                                      "display_name": "Get list of unique values",
                                      "script": "import json, sys\nlist1  = json.loads(sys.argv[1])\nlist_set = set(list1)\nunique = []\nunique_list = (list(list_set))\nfor x in unique_list:\n    unique.append(x)",
                                      "script_arguments": [
                                        "$activity.definition_activity_01KZ2HAND5NFQ1GzRxwwZSdh37DUHNAi9gs.output.result_string$"
                                      ],
                                      "script_queries": [
                                        {
                                          "script_query": "unique",
                                          "script_query_name": "unique",
                                          "script_query_type": "string"
                                        }
                                      ],
                                      "skip_execution": false
                                    },
                                    "object_type": "definition_activity"
                                  },
                                  {
                                    "unique_name": "definition_activity_01LHW5PUK92GB73Girn3TA6jjGbz7QRp231",
                                    "name": "Replace String",
                                    "title": "Remove special caracters",
                                    "type": "core.replacestring",
                                    "base_type": "activity",
                                    "properties": {
                                      "continue_on_failure": false,
                                      "display_name": "Remove special caracters",
                                      "input_string": "$activity.definition_activity_01LHUB7I238QW1lHLBnGyMatda7AqDsDf4c.output.script_queries.unique$",
                                      "replace_list": [
                                        {
                                          "replaced_string": "[",
                                          "replacement_string": ""
                                        },
                                        {
                                          "replaced_string": "]",
                                          "replacement_string": ""
                                        },
                                        {
                                          "replaced_string": "'",
                                          "replacement_string": ""
                                        }
                                      ],
                                      "skip_execution": false
                                    },
                                    "object_type": "definition_activity"
                                  },
                                  {
                                    "unique_name": "definition_activity_01LHUMHYDQNEC1F5iwgIBsdJuNr6CtvtnBw",
                                    "name": "Split String",
                                    "title": "Split list",
                                    "type": "core.splitstring",
                                    "base_type": "activity",
                                    "properties": {
                                      "boundaries": [
                                        {
                                          "boundary": ","
                                        }
                                      ],
                                      "continue_on_failure": false,
                                      "display_name": "Split list",
                                      "input_string": "$activity.definition_activity_01LHW5PUK92GB73Girn3TA6jjGbz7QRp231.output.result_string$",
                                      "remove_empty": true,
                                      "skip_execution": false
                                    },
                                    "object_type": "definition_activity"
                                  },
                                  {
                                    "unique_name": "definition_activity_01LHUF119Q87O4ve3bqnZw2jd7HKHzXTpH4",
                                    "name": "For Each",
                                    "title": "For Each",
                                    "type": "logic.for_each",
                                    "base_type": "activity",
                                    "properties": {
                                      "continue_on_failure": false,
                                      "display_name": "For Each",
                                      "skip_execution": false,
                                      "source_array": "$activity.definition_activity_01LHUMHYDQNEC1F5iwgIBsdJuNr6CtvtnBw.output.parts$"
                                    },
                                    "object_type": "definition_activity",
                                    "actions": [
                                      {
                                        "unique_name": "definition_activity_01LHWOY0015ZV1lUL0vzmw0Ecekic4dsxMi",
                                        "name": "Match Regex",
                                        "title": "Get domain only",
                                        "type": "core.matchregex",
                                        "base_type": "activity",
                                        "properties": {
                                          "continue_on_failure": false,
                                          "display_name": "Get domain only",
                                          "input_regex": "([a-zA-Z0-9\\.\\-]+)",
                                          "input_string": "$activity.definition_activity_01LHUF119Q87O4ve3bqnZw2jd7HKHzXTpH4.input.source_array[@]$",
                                          "match_case": true,
                                          "skip_execution": false
                                        },
                                        "object_type": "definition_activity"
                                      },
                                      {
                                        "unique_name": "definition_activity_01LHUFAI41K227P7CwSPDcbK6REyvPE5YW5",
                                        "name": "Add Row to Table",
                                        "title": "Add Row to Temp Domain Table",
                                        "type": "core.addrowtotable",
                                        "base_type": "activity",
                                        "properties": {
                                          "action_timeout": 180,
                                          "continue_on_failure": false,
                                          "display_name": "Add Row to Temp Domain Table",
                                          "input_table": "$workflow.definition_workflow_01KR64S9DG9DM0Ofa2N1vkui2uwDbrzoVo7.local.variable_workflow_01LHU7ZSWQ9315H6GHHZxC1CvAb0E2T1lYN$",
                                          "row": [
                                            {
                                              "key": "distinctvalue",
                                              "type": "string",
                                              "value": "$activity.definition_activity_01LHWOY0015ZV1lUL0vzmw0Ecekic4dsxMi.output.matching_strings[0]$"
                                            }
                                          ],
                                          "skip_execution": false
                                        },
                                        "object_type": "definition_activity"
                                      }
                                    ]
                                  }
                                ]
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "unique_name": "definition_activity_01LKZRQIHIH795FmumpWa2qaUqLMFvgoBQT",
                        "name": "Condition Block",
                        "title": "Condition Block",
                        "type": "logic.if_else",
                        "base_type": "activity",
                        "properties": {
                          "continue_on_failure": false,
                          "display_name": "Condition Block",
                          "skip_execution": false
                        },
                        "object_type": "definition_activity",
                        "blocks": [
                          {
                            "unique_name": "definition_activity_01LKZRSEPF2DQ1sxZcXoZRdi7tOwdSZV0i5",
                            "name": "Condition Branch",
                            "title": "If domain(s) bocked",
                            "type": "logic.condition_block",
                            "base_type": "activity",
                            "properties": {
                              "condition": {
                                "left_operand": "$activity.definition_activity_01KR6HEHTV4YG1O0OtMpI5BjAFhJOXzV6y3.output.succeeded$",
                                "operator": "eq",
                                "right_operand": true
                              },
                              "continue_on_failure": false,
                              "display_name": "If domain(s) bocked",
                              "skip_execution": false
                            },
                            "object_type": "definition_activity",
                            "actions": [
                              {
                                "unique_name": "definition_activity_01KZ1JYTLVZEM0Z0OBYhUCkxyyVOWr8cNxS",
                                "name": "CTR Generate Access Token",
                                "title": "CTR Generate Access Token",
                                "type": "workflow.atomic_workflow",
                                "base_type": "subworkflow",
                                "properties": {
                                  "continue_on_failure": true,
                                  "display_name": "CTR Generate Access Token",
                                  "runtime_user": {
                                    "target_default": true
                                  },
                                  "skip_execution": false,
                                  "target": {
                                    "override_workflow_target": true,
                                    "target_id": "definition_target_01JPDXZHEKFXE0DCxZKwz6FwRdYRl4UHHQx",
                                    "target_type": "web-service.endpoint"
                                  },
                                  "workflow_id": "definition_workflow_01779LB6MV0P02kvka9TGV5cEam84NrCTy4"
                                },
                                "object_type": "definition_activity"
                              },
                              {
                                "unique_name": "definition_activity_01LHWFYY5IVUD07rdWSrdLrgCMAPiMzRHih",
                                "name": "Select from Table",
                                "title": "Select Unique domain from Table",
                                "type": "core.selectfromtable",
                                "base_type": "activity",
                                "properties": {
                                  "action_timeout": 180,
                                  "columns": [
                                    {
                                      "column_name": "distinctvalue",
                                      "column_type": "string"
                                    }
                                  ],
                                  "continue_on_failure": true,
                                  "display_name": "Select Unique domain from Table",
                                  "input_table": "$workflow.definition_workflow_01KR64S9DG9DM0Ofa2N1vkui2uwDbrzoVo7.local.variable_workflow_01LHU7ZSWQ9315H6GHHZxC1CvAb0E2T1lYN$",
                                  "number_of_rows": {
                                    "all_rows": true,
                                    "at_most": false
                                  },
                                  "persist_output": false,
                                  "skip_execution": false,
                                  "sorting": {
                                    "no_sort": true,
                                    "sort_by": false
                                  }
                                },
                                "object_type": "definition_activity"
                              },
                              {
                                "unique_name": "definition_activity_01KR6UJTPT2FY4yFzpETi2bFW1mDPGL4N8D",
                                "name": "For Each",
                                "title": "For Each domain blocked",
                                "type": "logic.for_each",
                                "base_type": "activity",
                                "properties": {
                                  "continue_on_failure": true,
                                  "display_name": "For Each domain blocked",
                                  "skip_execution": false,
                                  "source_array": "$activity.definition_activity_01LHWFYY5IVUD07rdWSrdLrgCMAPiMzRHih.output.output_table$"
                                },
                                "object_type": "definition_activity",
                                "actions": [
                                  {
                                    "unique_name": "definition_activity_01KYY9M87QXSD56W6VARky03VWysnZxlZaa",
                                    "name": "Group",
                                    "title": "Check if alert already sent for this domain",
                                    "type": "logic.group",
                                    "base_type": "activity",
                                    "properties": {
                                      "continue_on_failure": false,
                                      "display_name": "Check if alert already sent for this domain",
                                      "skip_execution": false
                                    },
                                    "object_type": "definition_activity",
                                    "actions": [
                                      {
                                        "unique_name": "definition_activity_01KZ1IOBMVXUG4FfqLdXSDF4cjY8UDr0U5V",
                                        "name": "HTTP Request",
                                        "title": "Query Private Intel",
                                        "type": "web-service.http_request",
                                        "base_type": "activity",
                                        "properties": {
                                          "action_timeout": 180,
                                          "allow_auto_redirect": true,
                                          "continue_on_error_status_code": false,
                                          "continue_on_failure": true,
                                          "custom_headers": [
                                            {
                                              "name": "Authorization",
                                              "value": "Bearer $activity.definition_activity_01KZ1JYTLVZEM0Z0OBYhUCkxyyVOWr8cNxS.output.variable_workflow_01BNOOXA3G6MV1PGAvsfZOKDdMYcE6XS726$"
                                            }
                                          ],
                                          "display_name": "Query Private Intel",
                                          "method": "GET",
                                          "relative_url": "/ctia/judgement/search?fields=id\u0026fields=reason\u0026fields=observable.value\u0026query='$activity.definition_activity_01KR6UJTPT2FY4yFzpETi2bFW1mDPGL4N8D.input.source_array[@].distinctvalue$'",
                                          "runtime_user": {
                                            "override_target_runtime_user": false,
                                            "target_default": true
                                          },
                                          "skip_execution": false,
                                          "target": {
                                            "override_workflow_target": true,
                                            "target_id": "definition_target_01JR32G4G61IQ5tJFSRwH7Jd5jZggGc4NFQ"
                                          }
                                        },
                                        "object_type": "definition_activity"
                                      },
                                      {
                                        "unique_name": "definition_activity_01KZ25ZLACALA0PpDs3ZmfwOuuYTdv6IhR3",
                                        "name": "Read Table from JSON",
                                        "title": "Read Table from JSON",
                                        "type": "corejava.read_table_from_json",
                                        "base_type": "activity",
                                        "properties": {
                                          "action_timeout": 180,
                                          "continue_on_failure": true,
                                          "display_name": "Read Table from JSON",
                                          "input_json": "$activity.definition_activity_01KZ1IOBMVXUG4FfqLdXSDF4cjY8UDr0U5V.output.response_body$",
                                          "jsonpath_query": "$.[*]",
                                          "persist_output": true,
                                          "populate_columns": false,
                                          "skip_execution": false,
                                          "table_columns": [
                                            {
                                              "column_name": "reason",
                                              "column_type": "string"
                                            },
                                            {
                                              "column_name": "id",
                                              "column_type": "string"
                                            },
                                            {
                                              "column_name": "observable",
                                              "column_type": "string"
                                            }
                                          ]
                                        },
                                        "object_type": "definition_activity"
                                      }
                                    ]
                                  },
                                  {
                                    "unique_name": "definition_activity_01KR7SF2FM8ZT69HrbgAyejW4QOqsK5QyKB",
                                    "name": "Condition Block",
                                    "title": "Condition Block",
                                    "type": "logic.if_else",
                                    "base_type": "activity",
                                    "properties": {
                                      "continue_on_failure": true,
                                      "display_name": "Condition Block",
                                      "skip_execution": false
                                    },
                                    "object_type": "definition_activity",
                                    "blocks": [
                                      {
                                        "unique_name": "definition_activity_01KR7SFPCKT3L4sGciCAV3HSnkHI0eIscxL",
                                        "name": "Condition Branch",
                                        "title": "If not then alert",
                                        "type": "logic.condition_block",
                                        "base_type": "activity",
                                        "properties": {
                                          "condition": {
                                            "left_operand": "$activity.definition_activity_01KZ25ZLACALA0PpDs3ZmfwOuuYTdv6IhR3.output.succeeded$",
                                            "operator": "eq",
                                            "right_operand": false
                                          },
                                          "continue_on_failure": true,
                                          "display_name": "If not then alert",
                                          "skip_execution": false
                                        },
                                        "object_type": "definition_activity",
                                        "actions": [
                                          {
                                            "unique_name": "definition_activity_01KZ2MQFV3BKT1QivmIu6cv7H0PXBIE1j4o",
                                            "name": "HTTP Request",
                                            "title": "Add domain to Private Intel (Judgement)",
                                            "type": "web-service.http_request",
                                            "base_type": "activity",
                                            "properties": {
                                              "action_timeout": 180,
                                              "allow_auto_redirect": true,
                                              "body": "{\n  \"valid_time\": {\n    \"start_time\": \"2020-10-28T11:47:25.622Z\",\n    \"end_time\": \"2020-10-28T11:47:25.622Z\"\n  },\n  \"observable\": {\n    \"value\": \"$activity.definition_activity_01KR6UJTPT2FY4yFzpETi2bFW1mDPGL4N8D.input.source_array[@].distinctvalue$\",\n    \"type\": \"domain\"\n  },\n  \"type\": \"judgement\",\n  \"source\": \"SecureX AO\",\n  \"disposition\": 2,\n  \"reason\": \"AO\",\n  \"disposition_name\": \"Malicious\",\n  \"priority\": 0,\n  \"severity\": \"Medium\",\n  \"tlp\": \"white\",\n  \"timestamp\": \"2020-10-28T11:47:25.622Z\",\n  \"confidence\": \"Medium\"\n}",
                                              "content_type": "application/json",
                                              "continue_on_error_status_code": false,
                                              "continue_on_failure": true,
                                              "custom_headers": [
                                                {
                                                  "name": "Authorization",
                                                  "value": "Bearer $activity.definition_activity_01KZ1JYTLVZEM0Z0OBYhUCkxyyVOWr8cNxS.output.variable_workflow_01BNOOXA3G6MV1PGAvsfZOKDdMYcE6XS726$"
                                                }
                                              ],
                                              "display_name": "Add domain to Private Intel (Judgement)",
                                              "method": "POST",
                                              "relative_url": "/ctia/judgement?wait_for=false",
                                              "runtime_user": {
                                                "override_target_runtime_user": false,
                                                "target_default": true
                                              },
                                              "skip_execution": false,
                                              "target": {
                                                "override_workflow_target": true,
                                                "target_id": "definition_target_01JR32G4G61IQ5tJFSRwH7Jd5jZggGc4NFQ"
                                              }
                                            },
                                            "object_type": "definition_activity"
                                          },
                                          {
                                            "unique_name": "definition_activity_01KR9HZWQLOK06MqUasVHcgfs8UKebWyOGa",
                                            "name": "Replace String",
                                            "title": "Make domain not clickable",
                                            "type": "core.replacestring",
                                            "base_type": "activity",
                                            "properties": {
                                              "continue_on_failure": true,
                                              "display_name": "Make domain not clickable",
                                              "input_string": "$activity.definition_activity_01KR6UJTPT2FY4yFzpETi2bFW1mDPGL4N8D.input.source_array[@].distinctvalue$",
                                              "replace_list": [
                                                {
                                                  "replaced_string": ".",
                                                  "replacement_string": "[.]"
                                                }
                                              ],
                                              "skip_execution": false
                                            },
                                            "object_type": "definition_activity"
                                          },
                                          {
                                            "unique_name": "definition_activity_01KR76XT2TX1L5d62zMmyi65jIHSvi1tPAl",
                                            "name": "Webex Teams - Post Message to Room",
                                            "title": "Webex Teams - Post Message to Room",
                                            "type": "workflow.atomic_workflow",
                                            "base_type": "subworkflow",
                                            "properties": {
                                              "continue_on_failure": true,
                                              "display_name": "Webex Teams - Post Message to Room",
                                              "input": {
                                                "variable_workflow_01FGYY44G3MZ55amJu9YqgUeKS8GT49bZx3": "$global.variable_01KEH4RU5N6VM1dCv2HDrsRXCbj0pv64GI8.global.variable_01KEH4RU5N6VM1dCv2HDrsRXCbj0pv64GI8$",
                                                "variable_workflow_01FGYY44G3TK951Crpnd8g2izonyM4bFtpW": "$activity.definition_activity_01KR6VTPLBVQZ1CcI9ZOL11Oq3l61dNfoh1.output.variable_workflow_01FHSVE2R6ZTQ6L92WEi0kWgR5T8zhMAUzO$",
                                                "variable_workflow_01FGYY44G3UPV3heGGc3vXCV47YL5WoI2X6": "",
                                                "variable_workflow_01FGYZ9BV4QTP19CuMwcW8QywvCP9ymx2BZ": "Domain $activity.definition_activity_01KR9HZWQLOK06MqUasVHcgfs8UKebWyOGa.output.result_string$ blocked by Cisco Umbrella (Security Event)"
                                              },
                                              "runtime_user": {
                                                "target_default": true
                                              },
                                              "skip_execution": false,
                                              "target": {
                                                "override_workflow_target": true,
                                                "target_id": "definition_target_01KJANNE7TR2C6ahGVhbhP3X5JvEtPoSLKV",
                                                "target_type": "web-service.endpoint"
                                              },
                                              "workflow_id": "definition_workflow_01FGYY44YU521254ygN3Le0In0kEHpiPNpf"
                                            },
                                            "object_type": "definition_activity"
                                          }
                                        ]
                                      }
                                    ]
                                  }
                                ]
                              },
                              {
                                "unique_name": "definition_activity_01LHUG102C54E7MW8JZyv8mh2ghCft9V6Uv",
                                "name": "Delete from Table",
                                "title": "Clear temp domain table",
                                "type": "core.deleterowfromtable",
                                "base_type": "activity",
                                "properties": {
                                  "action_timeout": 180,
                                  "continue_on_failure": true,
                                  "display_name": "Clear temp domain table",
                                  "input_table": "$workflow.definition_workflow_01KR64S9DG9DM0Ofa2N1vkui2uwDbrzoVo7.local.variable_workflow_01LHU7ZSWQ9315H6GHHZxC1CvAb0E2T1lYN$",
                                  "rows": {
                                    "all_rows": true,
                                    "rows_matching_criteria": false
                                  },
                                  "skip_execution": false
                                },
                                "object_type": "definition_activity"
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "unique_name": "definition_activity_01LKZ1UTT67UJ2HILTyxZxFvscnoScJ1Wbz",
                        "name": "Sleep",
                        "title": "Sleep",
                        "type": "core.sleep",
                        "base_type": "activity",
                        "properties": {
                          "continue_on_failure": false,
                          "display_name": "Sleep",
                          "skip_execution": false,
                          "sleep_interval": 5
                        },
                        "object_type": "definition_activity"
                      },
                      {
                        "unique_name": "definition_activity_01LGYGUF8VA1O5FD3w0zbterLYb4Y8lGXfD",
                        "name": "Set Variables",
                        "title": "Loop counter +1",
                        "type": "core.set_multiple_variables",
                        "base_type": "activity",
                        "properties": {
                          "continue_on_failure": true,
                          "display_name": "Loop counter +1",
                          "skip_execution": false,
                          "variables_to_update": [
                            {
                              "variable_to_update": "$global.variable_01LGYFHE8DD8A7767SRhj0daGxv5R67jPTk.global.variable_01LGYFHE8DD8A7767SRhj0daGxv5R67jPTk$",
                              "variable_value_new": "$global.variable_01LGYFHE8DD8A7767SRhj0daGxv5R67jPTk.global.variable_01LGYFHE8DD8A7767SRhj0daGxv5R67jPTk$+1"
                            }
                          ]
                        },
                        "object_type": "definition_activity"
                      }
                    ]
                  }
                ]
              }
            ]
          },
          {
            "unique_name": "definition_activity_01LGYELSE01LA3138OMdhSFrVQAIHLPQmX9",
            "name": "Condition Branch",
            "title": "Condition Loop Counter not 500",
            "type": "logic.condition_block",
            "base_type": "activity",
            "properties": {
              "condition": {
                "left_operand": "$global.variable_01LGYFHE8DD8A7767SRhj0daGxv5R67jPTk.global.variable_01LGYFHE8DD8A7767SRhj0daGxv5R67jPTk$",
                "operator": "ne",
                "right_operand": 500
              },
              "continue_on_failure": false,
              "display_name": "Condition Loop Counter not 500",
              "skip_execution": false
            },
            "object_type": "definition_activity",
            "actions": [
              {
                "unique_name": "definition_activity_01LGYHFZ536J50VqEy0EIy2EG4sOBrgNPWL",
                "name": "Completed",
                "title": "Completed",
                "type": "logic.completed",
                "base_type": "activity",
                "properties": {
                  "completion_type": "succeeded",
                  "continue_on_failure": false,
                  "display_name": "Completed",
                  "skip_execution": false
                },
                "object_type": "definition_activity"
              }
            ]
          }
        ]
      }
    ],
    "categories": [
      "category_1BMfMXSnJMyt5Ihqi7rWJr5N8cf"
    ]
  },
  "targets": {
    "definition_target_01JLRTQCEHBA93OQhYXQCrV9TYW4Lmy1oS3": {
      "unique_name": "definition_target_01JLRTQCEHBA93OQhYXQCrV9TYW4Lmy1oS3",
      "name": "Cisco Umbrella Reporting API_v1",
      "title": "Cisco Umbrella Reporting API_v1",
      "type": "web-service.endpoint",
      "base_type": "target",
      "object_type": "definition_target",
      "properties": {
        "default_runtime_user_id": "definition_runtime_user_01JLRA8VF1WE33hotP5HWX5MmH6STnqkdoH",
        "disable_certificate_validation": false,
        "display_name": "Cisco Umbrella Reporting API_v1",
        "host": "reports.api.umbrella.com",
        "ignore_proxy": false,
        "no_runtime_user": false,
        "port": 443,
        "protocol": "https"
      }
    },
    "definition_target_01JPDXZHEKFXE0DCxZKwz6FwRdYRl4UHHQx": {
      "unique_name": "definition_target_01JPDXZHEKFXE0DCxZKwz6FwRdYRl4UHHQx",
      "name": "Cisco SX-TR For Access Token NAM",
      "title": "Cisco SX-TR For Access Token NAM",
      "type": "web-service.endpoint",
      "base_type": "target",
      "object_type": "definition_target",
      "properties": {
        "default_runtime_user_id": "definition_runtime_user_01JPDX0PZZKT533W9RABl04sC6b11nf0XAs",
        "disable_certificate_validation": false,
        "display_name": "Cisco SX-TR For Access Token NAM",
        "host": "visibility.amp.cisco.com",
        "ignore_proxy": false,
        "no_runtime_user": false,
        "path": "/iroh",
        "port": 443,
        "protocol": "https"
      }
    },
    "definition_target_01JR32G4G61IQ5tJFSRwH7Jd5jZggGc4NFQ": {
      "unique_name": "definition_target_01JR32G4G61IQ5tJFSRwH7Jd5jZggGc4NFQ",
      "name": "Cisco SX-TR Private Intel NAM",
      "title": "Cisco SX-TR Private Intel NAM",
      "type": "web-service.endpoint",
      "base_type": "target",
      "object_type": "definition_target",
      "properties": {
        "disable_certificate_validation": true,
        "display_name": "Cisco SX-TR Private Intel NAM",
        "host": "private.intel.amp.cisco.com",
        "ignore_proxy": false,
        "no_runtime_user": true,
        "protocol": "https"
      }
    },
    "definition_target_01KJANNE7TR2C6ahGVhbhP3X5JvEtPoSLKV": {
      "unique_name": "definition_target_01KJANNE7TR2C6ahGVhbhP3X5JvEtPoSLKV",
      "name": "Cisco Teams API",
      "title": "Cisco Teams API",
      "type": "web-service.endpoint",
      "base_type": "target",
      "object_type": "definition_target",
      "properties": {
        "disable_certificate_validation": false,
        "display_name": "Cisco Teams API",
        "host": "webexapis.com",
        "ignore_proxy": false,
        "no_runtime_user": true,
        "protocol": "https"
      }
    }
  },
  "runtime_users": {
    "definition_runtime_user_01JLRA8VF1WE33hotP5HWX5MmH6STnqkdoH": {
      "unique_name": "definition_runtime_user_01JLRA8VF1WE33hotP5HWX5MmH6STnqkdoH",
      "name": "Cisco Umbrella Reporting API",
      "title": "Cisco Umbrella Reporting API",
      "type": "runtime_user.web-service_basic_credentials",
      "base_type": "runtime_user",
      "object_type": "definition_runtime_user",
      "properties": {
        "auth_option": "*****",
        "basic_password": "*****",
        "basic_username": "*****",
        "display_name": "Cisco Umbrella Reporting API"
      }
    },
    "definition_runtime_user_01JPDX0PZZKT533W9RABl04sC6b11nf0XAs": {
      "unique_name": "definition_runtime_user_01JPDX0PZZKT533W9RABl04sC6b11nf0XAs",
      "name": "IVBERLIN - Cisco SX-TR NAM",
      "title": "IVBERLIN - Cisco SX-TR NAM",
      "type": "runtime_user.web-service_basic_credentials",
      "base_type": "runtime_user",
      "object_type": "definition_runtime_user",
      "properties": {
        "auth_option": "*****",
        "basic_password": "*****",
        "basic_username": "*****",
        "display_name": "IVBERLIN - Cisco SX-TR NAM"
      }
    }
  },
  "variables": {
    "variable_01KEH4RU5N6VM1dCv2HDrsRXCbj0pv64GI8": {
      "unique_name": "variable_01KEH4RU5N6VM1dCv2HDrsRXCbj0pv64GI8",
      "properties": {
        "value": "*****",
        "scope": "global",
        "name": "Cisco Teams BOT Token",
        "type": "datatype.secure_string",
        "is_required": false,
        "is_invisible": false
      },
      "object_type": "variable"
    },
    "variable_01LGYFHE8DD8A7767SRhj0daGxv5R67jPTk": {
      "unique_name": "variable_01LGYFHE8DD8A7767SRhj0daGxv5R67jPTk",
      "properties": {
        "value": 497,
        "scope": "global",
        "name": "Loop Counter  Umbrella Alerting AO",
        "type": "datatype.integer",
        "description": "Should be set to 500 at first run of the AO",
        "is_required": false,
        "is_invisible": false
      },
      "object_type": "variable"
    }
  },
  "table_types": {
    "tabletype_01EGEGSGVS20N13S1KPEz8fOy2ANAhTiYpj": {
      "unique_name": "tabletype_01EGEGSGVS20N13S1KPEz8fOy2ANAhTiYpj",
      "data_type": "datatype.tabletype",
      "display_name": "distinct_value_table",
      "columns": [
        {
          "name": "distinctvalue",
          "title": "distinctvalue",
          "type": "string"
        }
      ],
      "base_type": "datatype",
      "object_type": "tabletype"
    }
  },
  "atomic_workflows": [
    "definition_workflow_01FHMU6SD5XPL6eRW4zFXqkA1w8jWiQCIBU",
    "definition_workflow_01779LB6MV0P02kvka9TGV5cEam84NrCTy4",
    "definition_workflow_01FGYY44YU521254ygN3Le0In0kEHpiPNpf"
  ]
}