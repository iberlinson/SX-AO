{
  "workflow": {
    "unique_name": "definition_workflow_01JQ4X24X76JT05A05QhDmJMERQGZFoe7sm",
    "name": "Atomic - Webex Teams - Send Message to User",
    "title": "Atomic - Webex Teams - Send Message to User",
    "type": "generic.workflow",
    "base_type": "workflow",
    "variables": [
      {
        "schema_id": "datatype.string",
        "properties": {
          "value": "",
          "scope": "input",
          "name": "file",
          "type": "datatype.string",
          "is_required": false
        },
        "unique_name": "variable_workflow_01JQQ43KD9NHA2bUyMaKi5Ee9cCmuY6rEqi",
        "object_type": "variable_workflow"
      },
      {
        "schema_id": "datatype.string",
        "properties": {
          "value": "",
          "scope": "local",
          "name": "Webex JSON",
          "type": "datatype.string",
          "is_required": false
        },
        "unique_name": "variable_workflow_01JQ4X24NAFZ70iU50ubzIMplWNq1JJKp4L",
        "object_type": "variable_workflow"
      },
      {
        "schema_id": "datatype.string",
        "properties": {
          "value": "",
          "scope": "output",
          "name": "Response Body",
          "type": "datatype.string",
          "is_required": false
        },
        "unique_name": "variable_workflow_01JQ4X24NALUP1MuBueddxZbWJVCN8t8U6J",
        "object_type": "variable_workflow"
      },
      {
        "schema_id": "datatype.string",
        "properties": {
          "value": "",
          "scope": "input",
          "name": "Recipient Email",
          "type": "datatype.string",
          "description": "Email address of the person to send the message to",
          "is_required": false
        },
        "unique_name": "variable_workflow_01JQ4X24NAN2C5Jjw5KTj7B3Id2spTUwbZG",
        "object_type": "variable_workflow"
      },
      {
        "schema_id": "datatype.secure_string",
        "properties": {
          "value": "",
          "scope": "input",
          "name": "Access Token",
          "type": "datatype.secure_string",
          "description": "The access token to use to authenticate to the Webex Teams API",
          "is_required": true
        },
        "unique_name": "variable_workflow_01JQ4X24NAKJ87cxNowOTm7WYt7KpENwy31",
        "object_type": "variable_workflow"
      },
      {
        "schema_id": "datatype.string",
        "properties": {
          "value": "",
          "scope": "input",
          "name": "Message",
          "type": "datatype.string",
          "description": "A plain text message without markdown. If you provide a value for this field as well as the markdown message field, the markdown message will be displayed for clients that support it and this message will be shown for clients that don't\n\nInformation about formatting messages: https://developer.webex.com/docs/api/basics#formatting-messages",
          "is_required": false
        },
        "unique_name": "variable_workflow_01JQ4X24NAR5S0H5VlkJAeitbQ3HVvr2MRT",
        "object_type": "variable_workflow"
      },
      {
        "schema_id": "datatype.string",
        "properties": {
          "value": "",
          "scope": "output",
          "name": "Message ID",
          "type": "datatype.string",
          "is_required": false
        },
        "unique_name": "variable_workflow_01JQ4X24NAPZZ45O58S7vrAOHis4LQMiXb3",
        "object_type": "variable_workflow"
      },
      {
        "schema_id": "datatype.string",
        "properties": {
          "value": "",
          "scope": "input",
          "name": "Recipient ID",
          "type": "datatype.string",
          "description": "The ID of the user to send the message to",
          "is_required": false
        },
        "unique_name": "variable_workflow_01JQ4X24NAO8607jAXdOSmTfKagjmCj9g8h",
        "object_type": "variable_workflow"
      },
      {
        "schema_id": "datatype.string",
        "properties": {
          "value": "",
          "scope": "input",
          "name": "Markdown Message",
          "type": "datatype.string",
          "description": "A message that includes markdown. If you provide a value for this field as well as the message field, the markdown message will be displayed for clients that support it and the plain text message will be shown for clients that don't\n\nInformation about formatting messages: https://developer.webex.com/docs/api/basics#formatting-messages",
          "is_required": false
        },
        "unique_name": "variable_workflow_01JQ4X24NASAH5NbBp3kTtBdtr2tojldpau",
        "object_type": "variable_workflow"
      }
    ],
    "properties": {
      "atomic": {
        "atomic_group": "Cisco Webex Teams",
        "is_atomic": true
      },
      "delete_workflow_instance": true,
      "description": "Sends a message to a Webex Teams user using their email address. You can provide a plain text message, a message with markdown, or both. If you provide both, the message with markdown is displayed for clients that support it and the plain text message is displayed for clients that don't.\n\n[] Validate that a user ID or email address was provided\n[] Validate that either a message or markdown message was provided\n[] Generate the JSON to POST to Webex\n[] Send the request to the Webex Teams API\n[] Check if the request was successful and set output variables\n\nInformation about formatting messages: https://developer.webex.com/docs/api/basics#formatting-messages",
      "display_name": "Atomic - Webex Teams - Send Message to User",
      "runtime_user": {
        "override_target_runtime_user": false,
        "specify_on_workflow_start": false,
        "target_default": true
      },
      "target": {
        "target_type": "web-service.endpoint",
        "specify_on_workflow_start": true
      }
    },
    "object_type": "definition_workflow",
    "actions": [
      {
        "unique_name": "definition_activity_01JQ4X2NX3TCB0Xf3jQQlNYyBRtKD17oH1u",
        "name": "Condition Block",
        "title": "Was an ID or email given?",
        "type": "logic.if_else",
        "base_type": "activity",
        "properties": {
          "continue_on_failure": false,
          "display_name": "Was an ID or email given?",
          "skip_execution": false
        },
        "object_type": "definition_activity",
        "blocks": [
          {
            "unique_name": "definition_activity_01JQ4X2T6H1FY1j11ojZdLOdZ7L7nf0oohF",
            "name": "Condition Branch",
            "title": "No",
            "type": "logic.condition_block",
            "base_type": "activity",
            "properties": {
              "condition": {
                "left_operand": {
                  "left_operand": "$workflow.definition_workflow_01JQ4X24X76JT05A05QhDmJMERQGZFoe7sm.input.variable_workflow_01JQ4X24NAN2C5Jjw5KTj7B3Id2spTUwbZG$",
                  "operator": "eq",
                  "right_operand": ""
                },
                "operator": "and",
                "right_operand": {
                  "left_operand": "$workflow.definition_workflow_01JQ4X24X76JT05A05QhDmJMERQGZFoe7sm.input.variable_workflow_01JQ4X24NAO8607jAXdOSmTfKagjmCj9g8h$",
                  "operator": "eq",
                  "right_operand": ""
                }
              },
              "continue_on_failure": false,
              "display_name": "No",
              "skip_execution": false
            },
            "object_type": "definition_activity",
            "actions": [
              {
                "unique_name": "definition_activity_01JQ4X2WS6SS63zuotxIWskOmQEFTqJ8S7B",
                "name": "Completed",
                "title": "Failed",
                "type": "logic.completed",
                "base_type": "activity",
                "properties": {
                  "completion_type": "failed-completed",
                  "continue_on_failure": false,
                  "display_name": "Failed",
                  "result_message": "A recipient ID or email address is required",
                  "skip_execution": false
                },
                "object_type": "definition_activity"
              }
            ]
          }
        ]
      },
      {
        "unique_name": "definition_activity_01JQ4X32QBZBW2w5Hnxee7qmnIlxxHuC5cn",
        "name": "Execute Python Script",
        "title": "Check if either message is populated",
        "type": "python3.script",
        "base_type": "activity",
        "properties": {
          "action_timeout": 180,
          "continue_on_failure": false,
          "display_name": "Check if either message is populated",
          "script": "import sys,json\n\nmessage = sys.argv[1]\nmarkdown = sys.argv[2]\n\nhasMessage = False\n\nif message != \"\" or markdown != \"\": hasMessage = True",
          "script_arguments": [
            "$workflow.definition_workflow_01JQ4X24X76JT05A05QhDmJMERQGZFoe7sm.input.variable_workflow_01JQ4X24NAR5S0H5VlkJAeitbQ3HVvr2MRT$",
            "$workflow.definition_workflow_01JQ4X24X76JT05A05QhDmJMERQGZFoe7sm.input.variable_workflow_01JQ4X24NASAH5NbBp3kTtBdtr2tojldpau$"
          ],
          "script_queries": [
            {
              "script_query": "hasMessage",
              "script_query_name": "hasMessage",
              "script_query_type": "boolean"
            }
          ],
          "skip_execution": false
        },
        "object_type": "definition_activity"
      },
      {
        "unique_name": "definition_activity_01JQ4X392HSFE3r4XIkefvSGM0KVaMIU4Fz",
        "name": "Condition Block",
        "title": "Was a message provided?",
        "type": "logic.if_else",
        "base_type": "activity",
        "properties": {
          "continue_on_failure": false,
          "display_name": "Was a message provided?",
          "skip_execution": false
        },
        "object_type": "definition_activity",
        "blocks": [
          {
            "unique_name": "definition_activity_01JQ4X3F69HLM3CG4n6UQfvni4Wm45XvnMj",
            "name": "Condition Branch",
            "title": "No",
            "type": "logic.condition_block",
            "base_type": "activity",
            "properties": {
              "condition": {
                "left_operand": "$activity.definition_activity_01JQ4X32QBZBW2w5Hnxee7qmnIlxxHuC5cn.output.script_queries.hasMessage$",
                "operator": "eq",
                "right_operand": false
              },
              "continue_on_failure": false,
              "display_name": "No",
              "skip_execution": false
            },
            "object_type": "definition_activity",
            "actions": [
              {
                "unique_name": "definition_activity_01JQ4X3JEITTV73bc6czzKoce2dKy6PjfFM",
                "name": "Completed",
                "title": "Failed",
                "type": "logic.completed",
                "base_type": "activity",
                "properties": {
                  "completion_type": "failed-completed",
                  "continue_on_failure": false,
                  "display_name": "Failed",
                  "result_message": "A markdown message or plain text message (or both) is required",
                  "skip_execution": false
                },
                "object_type": "definition_activity"
              }
            ]
          }
        ]
      },
      {
        "unique_name": "definition_activity_01JQ4X3PGR88Z4tl3U4mGwgopzv6i7LvHYF",
        "name": "Replace String",
        "title": "Escape quotes in the markdown",
        "type": "core.replacestring",
        "base_type": "activity",
        "properties": {
          "continue_on_failure": false,
          "display_name": "Escape quotes in the markdown",
          "input_string": "$workflow.definition_workflow_01JQ4X24X76JT05A05QhDmJMERQGZFoe7sm.input.variable_workflow_01JQ4X24NASAH5NbBp3kTtBdtr2tojldpau$",
          "replace_list": [
            {
              "replaced_string": "\"",
              "replacement_string": "\\\""
            }
          ],
          "skip_execution": false
        },
        "object_type": "definition_activity"
      },
      {
        "unique_name": "definition_activity_01JQ4X3VPG02M7WmWBZokbbPF0QjXhgt8GF",
        "name": "Replace String",
        "title": "Escape quotes in the message",
        "type": "core.replacestring",
        "base_type": "activity",
        "properties": {
          "continue_on_failure": false,
          "display_name": "Escape quotes in the message",
          "input_string": "$workflow.definition_workflow_01JQ4X24X76JT05A05QhDmJMERQGZFoe7sm.input.variable_workflow_01JQ4X24NAR5S0H5VlkJAeitbQ3HVvr2MRT$",
          "replace_list": [
            {
              "replaced_string": "\"",
              "replacement_string": "\\\""
            }
          ],
          "skip_execution": false
        },
        "object_type": "definition_activity"
      },
      {
        "unique_name": "definition_activity_01JQ4X41NGBDM49RPGF8GQkVeadB17wYfu7",
        "name": "Condition Block",
        "title": "Are we using person ID or email?",
        "type": "logic.if_else",
        "base_type": "activity",
        "properties": {
          "continue_on_failure": false,
          "display_name": "Are we using person ID or email?",
          "skip_execution": false
        },
        "object_type": "definition_activity",
        "blocks": [
          {
            "unique_name": "definition_activity_01JQ4X47BYZGW40wVwmQGlbQSIzBigaVc08",
            "name": "Condition Branch",
            "title": "Person ID",
            "type": "logic.condition_block",
            "base_type": "activity",
            "properties": {
              "condition": {
                "left_operand": "$workflow.definition_workflow_01JQ4X24X76JT05A05QhDmJMERQGZFoe7sm.input.variable_workflow_01JQ4X24NAO8607jAXdOSmTfKagjmCj9g8h$",
                "operator": "ne",
                "right_operand": ""
              },
              "continue_on_failure": false,
              "display_name": "Person ID",
              "skip_execution": false
            },
            "object_type": "definition_activity",
            "actions": [
              {
                "unique_name": "definition_activity_01JQ4X4BJ1MP64jDjHrdXiNLVwZWitljXne",
                "name": "Set Variables",
                "title": "Set payload",
                "type": "core.set_multiple_variables",
                "base_type": "activity",
                "properties": {
                  "continue_on_failure": false,
                  "display_name": "Set payload",
                  "skip_execution": false,
                  "variables_to_update": [
                    {
                      "variable_to_update": "$workflow.definition_workflow_01JQ4X24X76JT05A05QhDmJMERQGZFoe7sm.local.variable_workflow_01JQ4X24NAFZ70iU50ubzIMplWNq1JJKp4L$",
                      "variable_value_new": "{\n\"toPersonId\": \"$workflow.definition_workflow_01JQ4X24X76JT05A05QhDmJMERQGZFoe7sm.input.variable_workflow_01JQ4X24NAO8607jAXdOSmTfKagjmCj9g8h$\",\n\"text\": \"$activity.definition_activity_01JQ4X3VPG02M7WmWBZokbbPF0QjXhgt8GF.output.result_string$\",\n\"markdown\": \"$activity.definition_activity_01JQ4X3PGR88Z4tl3U4mGwgopzv6i7LvHYF.output.result_string$\"\n\"file\":\"$workflow.definition_workflow_01JQ4X24X76JT05A05QhDmJMERQGZFoe7sm.input.variable_workflow_01JQQ43KD9NHA2bUyMaKi5Ee9cCmuY6rEqi$\"\n}"
                    }
                  ]
                },
                "object_type": "definition_activity"
              }
            ]
          },
          {
            "unique_name": "definition_activity_01JQ4X4IAKDVF7aVN0ehDeLtaJAiBwkBXAr",
            "name": "Condition Branch",
            "title": "Person Email",
            "type": "logic.condition_block",
            "base_type": "activity",
            "properties": {
              "condition": {
                "left_operand": "$workflow.definition_workflow_01JQ4X24X76JT05A05QhDmJMERQGZFoe7sm.input.variable_workflow_01JQ4X24NAN2C5Jjw5KTj7B3Id2spTUwbZG$",
                "operator": "ne",
                "right_operand": ""
              },
              "continue_on_failure": false,
              "display_name": "Person Email",
              "skip_execution": false
            },
            "object_type": "definition_activity",
            "actions": [
              {
                "unique_name": "definition_activity_01JQ4X4MELJEN5pFZnceFerSTHFwecvbplf",
                "name": "Set Variables",
                "title": "Set payload",
                "type": "core.set_multiple_variables",
                "base_type": "activity",
                "properties": {
                  "continue_on_failure": false,
                  "display_name": "Set payload",
                  "skip_execution": false,
                  "variables_to_update": [
                    {
                      "variable_to_update": "$workflow.definition_workflow_01JQ4X24X76JT05A05QhDmJMERQGZFoe7sm.local.variable_workflow_01JQ4X24NAFZ70iU50ubzIMplWNq1JJKp4L$",
                      "variable_value_new": "{\n\"toPersonEmail\": \"$workflow.definition_workflow_01JQ4X24X76JT05A05QhDmJMERQGZFoe7sm.input.variable_workflow_01JQ4X24NAN2C5Jjw5KTj7B3Id2spTUwbZG$\",\n\"text\": \"$activity.definition_activity_01JQ4X3VPG02M7WmWBZokbbPF0QjXhgt8GF.output.result_string$\",\n\"markdown\": \"$activity.definition_activity_01JQ4X3PGR88Z4tl3U4mGwgopzv6i7LvHYF.output.result_string$\",\n\"files\":\"$workflow.definition_workflow_01JQ4X24X76JT05A05QhDmJMERQGZFoe7sm.input.variable_workflow_01JQQ43KD9NHA2bUyMaKi5Ee9cCmuY6rEqi$\"\n}"
                    }
                  ]
                },
                "object_type": "definition_activity"
              }
            ]
          }
        ]
      },
      {
        "unique_name": "definition_activity_01JQ4X4TUH6VI4Srz3fQSgOtyL88HCQdlJF",
        "name": "HTTP Request",
        "title": "Send message",
        "type": "web-service.http_request",
        "base_type": "activity",
        "properties": {
          "accept": "application/json",
          "action_timeout": 180,
          "allow_auto_redirect": true,
          "body": "$workflow.definition_workflow_01JQ4X24X76JT05A05QhDmJMERQGZFoe7sm.local.variable_workflow_01JQ4X24NAFZ70iU50ubzIMplWNq1JJKp4L$",
          "content_type": "application/json",
          "continue_on_error_status_code": true,
          "continue_on_failure": false,
          "custom_headers": [
            {
              "name": "Authorization",
              "value": "Bearer $workflow.definition_workflow_01JQ4X24X76JT05A05QhDmJMERQGZFoe7sm.input.variable_workflow_01JQ4X24NAKJ87cxNowOTm7WYt7KpENwy31$"
            }
          ],
          "display_name": "Send message",
          "method": "POST",
          "relative_url": "/v1/messages",
          "runtime_user": {
            "override_target_runtime_user": false,
            "target_default": true
          },
          "skip_execution": false,
          "target": {
            "override_workflow_target": false,
            "override_workflow_target_group_criteria": false,
            "use_workflow_target": true,
            "use_workflow_target_group": false
          }
        },
        "object_type": "definition_activity"
      },
      {
        "unique_name": "definition_activity_01JQ4X5026Y522hCTzM2HC5obVkA429fF1F",
        "name": "Condition Block",
        "title": "Was the request successful?",
        "type": "logic.if_else",
        "base_type": "activity",
        "properties": {
          "continue_on_failure": false,
          "display_name": "Was the request successful?",
          "skip_execution": false
        },
        "object_type": "definition_activity",
        "blocks": [
          {
            "unique_name": "definition_activity_01JQ4X56CKT5J6ZAekzwDVsrCWWQZ1NguM5",
            "name": "Condition Branch",
            "title": "Yes/200",
            "type": "logic.condition_block",
            "base_type": "activity",
            "properties": {
              "condition": {
                "left_operand": "$activity.definition_activity_01JQ4X4TUH6VI4Srz3fQSgOtyL88HCQdlJF.output.status_code$",
                "operator": "eq",
                "right_operand": 200
              },
              "continue_on_failure": false,
              "display_name": "Yes/200",
              "skip_execution": false
            },
            "object_type": "definition_activity",
            "actions": [
              {
                "unique_name": "definition_activity_01JQ4X5AWML161Rz4tjYWlLPmcqxHKKhToA",
                "name": "JSONPath Query",
                "title": "Extract the message ID",
                "type": "corejava.jsonpathquery",
                "base_type": "activity",
                "properties": {
                  "action_timeout": 180,
                  "continue_on_failure": false,
                  "display_name": "Extract the message ID",
                  "input_json": "$activity.definition_activity_01JQ4X4TUH6VI4Srz3fQSgOtyL88HCQdlJF.output.response_body$",
                  "jsonpath_queries": [
                    {
                      "jsonpath_query": "$.id",
                      "jsonpath_query_name": "id",
                      "jsonpath_query_type": "string"
                    }
                  ],
                  "skip_execution": false
                },
                "object_type": "definition_activity"
              },
              {
                "unique_name": "definition_activity_01JQ4X5I25YTG5G5mVCEpkwDj6nL4L7y4Sk",
                "name": "Set Variables",
                "title": "Set output variables",
                "type": "core.set_multiple_variables",
                "base_type": "activity",
                "properties": {
                  "continue_on_failure": false,
                  "display_name": "Set output variables",
                  "skip_execution": false,
                  "variables_to_update": [
                    {
                      "variable_to_update": "$workflow.definition_workflow_01JQ4X24X76JT05A05QhDmJMERQGZFoe7sm.output.variable_workflow_01JQ4X24NALUP1MuBueddxZbWJVCN8t8U6J$",
                      "variable_value_new": "$activity.definition_activity_01JQ4X4TUH6VI4Srz3fQSgOtyL88HCQdlJF.output.response_body$"
                    },
                    {
                      "variable_to_update": "$workflow.definition_workflow_01JQ4X24X76JT05A05QhDmJMERQGZFoe7sm.output.variable_workflow_01JQ4X24NAPZZ45O58S7vrAOHis4LQMiXb3$",
                      "variable_value_new": "$activity.definition_activity_01JQ4X5AWML161Rz4tjYWlLPmcqxHKKhToA.output.jsonpath_queries.id$"
                    }
                  ]
                },
                "object_type": "definition_activity"
              }
            ]
          },
          {
            "unique_name": "definition_activity_01JQ4X5PBC8HY1LWtEVsfIG5oesNQLUI3Q4",
            "name": "Condition Branch",
            "title": "Failed",
            "type": "logic.condition_block",
            "base_type": "activity",
            "properties": {
              "condition": {
                "left_operand": {
                  "left_operand": "$activity.definition_activity_01JQ4X4TUH6VI4Srz3fQSgOtyL88HCQdlJF.output.status_code$",
                  "operator": "ne",
                  "right_operand": 200
                },
                "operator": "and",
                "right_operand": {
                  "left_operand": "$activity.definition_activity_01JQ4X4TUH6VI4Srz3fQSgOtyL88HCQdlJF.output.status_code$",
                  "operator": "ne",
                  "right_operand": 204
                }
              },
              "continue_on_failure": false,
              "display_name": "Failed",
              "skip_execution": false
            },
            "object_type": "definition_activity",
            "actions": [
              {
                "unique_name": "definition_activity_01JQ4X5TCXDS33xWsbkPOvTMXrZoktkEhjb",
                "name": "Failed",
                "title": "Failed",
                "type": "logic.completed",
                "base_type": "activity",
                "properties": {
                  "completion_type": "failed-completed",
                  "continue_on_failure": false,
                  "display_name": "Failed",
                  "result_message": "Failed to send Webex Teams message:\n\nStatus code: $activity.definition_activity_01JQ4X4TUH6VI4Srz3fQSgOtyL88HCQdlJF.output.status_code$\nError message: $activity.definition_activity_01JQ4X4TUH6VI4Srz3fQSgOtyL88HCQdlJF.output.response_body$",
                  "skip_execution": false
                },
                "object_type": "definition_activity"
              }
            ]
          }
        ]
      }
    ],
    "categories": [
      "category_1BMfMXSnJMyt5Ihqi7rWJr5N8cf"
    ]
  }
}